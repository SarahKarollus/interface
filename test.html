<!DOCTYPE html>
<html>
<head>
    <!-- Meta-Daten -->
    <meta charset="utf-8">
    <title>AR Web App with A-Frame and AR.js</title>
    <!-- Einbindung des A-Frame Frameworks -->
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <!-- Einbindung der AR.js Komponente für A-Frame -->
    <script src="https://cdn.jsdelivr.net/npm/ar.js/aframe/build/aframe-ar.js"></script>
    <!-- Optional: QR-Code Scanner Bibliothek -->
    <script src="https://cdn.jsdelivr.net/npm/jsqr/dist/jsQR.min.js"></script>


    <style>
        /* CSS styles */
        body {
            margin: 0; /* Entfernt den Standard-Rand */
            overflow: hidden; /* Verhindert das Scrollen */
        }
        #scanner-video {
            display: none; /* Versteckt das Videoelement, das für das Scannen von QR-Codes verwendet wird */
        }
    </style>

</head>



<body>
    <!-- Videoelement für das Scannen von QR-Codes -->
    <video id="scanner-video" autoplay></video>
    <script>
        // Funktion zum Starten des QR-Code Scanners
        async function startQRCodeScanner(videoElement) {
            try {
                // Zugriff auf die Kamera des Geräts
                const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } });
                videoElement.srcObject = stream; // Videoelement zeigt den Kamera-Stream
            } catch (error) {
                console.error('Error accessing camera:', error); // Fehlerbehandlung
                alert('Error accessing camera. Please allow access to your camera and reload the page.'); // Benutzerhinweis
            }
        }

        // Funktion zum Scannen des QR-Codes aus dem Video
        async function scanQRCodeFromVideo(videoElement) {
            const canvas = document.createElement('canvas'); // Erstellen eines Canvas-Elements
            const ctx = canvas.getContext('2d'); // Holen des 2D-Kontexts
            canvas.width = videoElement.videoWidth; // Setzen der Breite des Canvas
            canvas.height = videoElement.videoHeight; // Setzen der Höhe des Canvas

            return new Promise((resolve) => {
                const interval = setInterval(() => { // Intervall zum regelmäßigen Scannen
                    ctx.drawImage(videoElement, 0, 0, canvas.width, canvas.height); // Zeichnen des Video-Frames auf das Canvas
                    const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height); // Extrahieren der Bilddaten
                    const code = jsQR(imageData.data, imageData.width, imageData.height, {
                        inversionAttempts: 'dontInvert', // QR-Code Scannen
                    });
                    if (code) { // Wenn ein QR-Code erkannt wird
                        clearInterval(interval); // Stoppt das Intervall
                        resolve(code.data); // Gibt die Daten des QR-Codes zurück
                    }
                }, 1000); // Scannt jede Sekunde
            });
        }
 // Funktion zum Verarbeiten des gescannten QR-Codes
 function handleQRCodeScan(result) {
            if (result) {
                const scene = document.querySelector('a-scene'); // Holen der A-Frame Szene
                scene.setAttribute('arjs', 'sourceType: webcam; debugUIEnabled: false;'); // Setzen der AR.js Attribute
                alert('QR-Code erkannt: ' + result); // Benutzerhinweis
            } else {
                alert('QR-Code nicht erkannt oder ungültig.'); // Fehlerhinweis
            }
        }

        // Event-Listener, der ausgeführt wird, wenn die Seite geladen ist
        document.addEventListener('DOMContentLoaded', async () => {
            const videoElement = document.getElementById('scanner-video'); // Holen des Videoelements
            await startQRCodeScanner(videoElement); // Startet den QR-Code Scanner
            const qrCodeData = await scanQRCodeFromVideo(videoElement); // Scannt den QR-Code
            handleQRCodeScan(qrCodeData); // Verarbeitet das Ergebnis des Scans
        });
    </script>


     <!-- A-Frame Szene für Augmented Reality -->

    <a-scene embedded arjs="sourceType: webcam; debugUIEnabled: false;">

        <!-- Marker 1 -->
        <a-marker type="pattern" url="Marker/pattern-Marker_1.patt">
             <!-- 3D-Modell für Marker 1 -->
            <a-entity obj-model="obj: url(Models/statue_1.obj); mtl: url(Models/statue_1.mtl)"
                      position="0 0 0"  
                      rotation="270 0"
                      scale="0.01 0.01 0.01">
            </a-entity>
        </a-marker>

        
        
        <a-marker type="pattern" url="Marker/pattern-Marker versuch flagge">
             
            <a-entity obj-model="obj: url(Models/statue_2.obj); mtl: url(Models/statue_2.mtl)"
                      position="0 0 0"
                      rotation="270 180"
                      scale="0.05 0.05 0.05">
            </a-entity>
        </a-marker>
        
        

        <!-- Kamera für AR-Ansicht -->
        <a-entity camera></a-entity>
    </a-scene>
</body>
</html>
