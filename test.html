<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>AR Web App with A-Frame and AR.js</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script> <!-- A-Frame Framework -->
    <script src="https://cdn.jsdelivr.net/npm/ar.js/aframe/build/aframe-ar.js"></script> <!-- AR.js Component for A-Frame -->
    <!-- Optional: QR Code Scanner library -->
    <script src="https://cdn.jsdelivr.net/npm/jsqr/dist/jsQR.min.js"></script> <!-- JSQR for QR code scanning -->
    <!-- Optional: QuaggaJS for QR code scanning -->
    <!-- <script src="https://cdn.jsdelivr.net/npm/quagga"></script> -->

    <style>
        /* Optional: CSS styles */
        body {
            margin: 0;
            overflow: hidden;
        }
        #scanner-video {
            display: none; /* Hide video element used for QR code scanning */
        }
    </style>
</head>
<body>
    <video id="scanner-video"></video> <!-- Video element for QR code scanning (hidden) -->
    <script>
        // Optional: QR Code Scanner function using JSQR library
        async function scanQRCodeFromVideo(videoElement) {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = videoElement.videoWidth;
            canvas.height = videoElement.videoHeight;
            ctx.drawImage(videoElement, 0, 0, canvas.width, canvas.height);
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            const code = jsQR(imageData.data, imageData.width, imageData.height, {
                inversionAttempts: 'dontInvert',
            });
            return code ? code.data : null;
        }

        // Handle QR Code scanning result
        function handleQRCodeScan(result) {
            if (result) {
                // Activate AR scene based on the scanned QR code
                const scene = document.querySelector('a-scene');
                scene.setAttribute('arjs', 'sourceType: webcam; debugUIEnabled: false;');
            } else {
                alert('QR-Code nicht erkannt oder ungÃ¼ltig.');
            }
        }

        // Optional: Start scanning QR codes when the video element is ready
        document.getElementById('scanner-video').addEventListener('loadedmetadata', async () => {
            try {
                const qrCodeData = await scanQRCodeFromVideo(document.getElementById('scanner-video'));
                handleQRCodeScan(qrCodeData);
            } catch (error) {
                console.error('Error scanning QR code:', error);
            }
        });
    </script>

    <a-scene embedded arjs="sourceType: webcam; debugUIEnabled: false;">
        <!-- Marker definition -->
        <a-marker preset="hiro">
            <!-- AR content to display when the marker is detected -->
            <a-box position="0 0.5 0" material="color: red;"></a-box>
        </a-marker>

        <!-- Optional: Add camera entity for AR view -->
        <a-entity camera></a-entity>
    </a-scene>
</body>
</html>
