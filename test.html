<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>AR Web App with A-Frame and AR.js</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script> <!-- A-Frame Framework -->
    <script src="https://cdn.jsdelivr.net/npm/ar.js/aframe/build/aframe-ar.js"></script> <!-- AR.js Component for A-Frame -->
    <!-- Optional: QR Code Scanner library -->
    <script src="https://cdn.jsdelivr.net/npm/jsqr/dist/jsQR.min.js"></script> <!-- JSQR for QR code scanning -->

    <style>
        /* Optional: CSS styles */
        body {
            margin: 0;
            overflow: hidden;
        }
        #scanner-video {
            display: none; /* Hide video element used for QR code scanning */
        }
    </style>
</head>
<body>
    <video id="scanner-video" autoplay></video> <!-- Video element for QR code scanning -->
    <script>
        async function startQRCodeScanner(videoElement) {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } });
                videoElement.srcObject = stream;
            } catch (error) {
                console.error('Error accessing camera:', error);
                alert('Error accessing camera. Please allow access to your camera and reload the page.');
            }
        }

        async function scanQRCodeFromVideo(videoElement) {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = videoElement.videoWidth;
            canvas.height = videoElement.videoHeight;

            return new Promise((resolve) => {
                const interval = setInterval(() => {
                    ctx.drawImage(videoElement, 0, 0, canvas.width, canvas.height);
                    const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                    const code = jsQR(imageData.data, imageData.width, imageData.height, {
                        inversionAttempts: 'dontInvert',
                    });
                    if (code) {
                        clearInterval(interval);
                        resolve(code.data);
                    }
                }, 1000); // Scan every second
            });
        }

        function handleQRCodeScan(result) {
            if (result) {
                const scene = document.querySelector('a-scene');
                scene.setAttribute('arjs', 'sourceType: webcam; debugUIEnabled: false;');
                alert('QR-Code erkannt: ' + result);
            } else {
                alert('QR-Code nicht erkannt oder ungÃ¼ltig.');
            }
        }

        document.addEventListener('DOMContentLoaded', async () => {
            const videoElement = document.getElementById('scanner-video');
            await startQRCodeScanner(videoElement);
            const qrCodeData = await scanQRCodeFromVideo(videoElement);
            handleQRCodeScan(qrCodeData);
        });
    </script>

    <a-scene embedded arjs="sourceType: webcam; debugUIEnabled: false;">
        <!-- Marker 1 -->
        <a-marker type="pattern" url="Marker\pattern-Marker 1.patt">
            <a-box position="0 0.5 0" material="color: red;"></a-box>
        </a-marker>

        <!-- Marker 2 -->
        <a-marker type="pattern" url="Marker\pattern-Marker 2.patt">
            <a-sphere position="0 0.5 0" radius="0.5" material="color: green;"></a-sphere>
        </a-marker>

        <!-- Marker 3 -->
        <a-marker type="pattern" url="Marker\pattern-Marker 3.patt">
            <a-cylinder position="0 0.5 0" radius="0.25" height="1" material="color: blue;"></a-cylinder>
        </a-marker>

        <!-- Optional: Add camera entity for AR view -->
        <a-entity camera></a-entity>
    </a-scene>
</body>
</html>
